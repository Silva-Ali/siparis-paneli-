<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portföy Panosu</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
:root{--bg-color:#121212;--surface-color:#1E1E1E;--primary-text:#E0E0E0;--secondary-text:#A0A0A0;--green:#26A69A;--red:#EF5350;--border-color:#333333;--gold:#FFD700;--blue:#03A9F4;--highlight-color:#2a2a2a;}
body{font-family:'Roboto',sans-serif;background-color:var(--bg-color);color:var(--primary-text);margin:0;padding:20px;transition: background-color 0.3s, color 0.3s;}
body.light-theme{--bg-color:#F0F2F5;--surface-color:#FFFFFF;--primary-text:#1C1E21;--secondary-text:#606770;--border-color:#DADDE1;--highlight-color:#EBF5FF;}
body.modal-open{overflow:hidden;}
#particles-js{position:fixed;width:100%;height:100%;top:0;left:0;z-index:-1;}
.container{max-width:1400px;margin:0 auto;background-color:var(--surface-color);padding:25px 40px;border-radius:12px;border:1px solid var(--border-color);box-shadow:0 10px 30px rgba(0,0,0,0.1);transition: background-color 0.3s, border-color 0.3s;}
.ticker-wrap{width:100%;overflow:hidden;background-color:var(--bg-color);padding:10px 0;border-bottom:1px solid var(--border-color);margin-bottom:25px;transition: background-color 0.3s, border-color 0.3s;}
.secondary-ticker{margin-top:30px;margin-bottom:0;border-top:1px solid var(--border-color);border-bottom:none;font-size:0.9em;}
.ticker-move{display:inline-block;white-space:nowrap;animation:scroll-left 40s linear infinite;}
.ticker-item{display:inline-block;margin:0 25px;font-size:1em;color:var(--secondary-text);}
.ticker-item .symbol{color:var(--primary-text);font-weight:bold;}
@keyframes scroll-left{0%{transform:translateX(100%);} 100%{transform:translateX(-100%);}}
header .header-top{display:flex;justify-content:space-between;align-items:center;padding-bottom:15px;gap:15px;}
header .profile{display:flex;align-items:center;gap:15px;}
header .profile img{width:60px;height:60px;border-radius:50%;border:2px solid var(--blue);object-fit:cover;background-color:#333;}
.header-actions{display:flex;align-items:center;gap:10px;}
.summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:25px 0;text-align:left;}
.summary.is-updated .summary-item{animation:refresh-pulse .6s ease;}
.summary-item{background-color:var(--bg-color);padding:20px;border-radius:8px;border:1px solid var(--border-color);transition: all .2s ease-in-out;}
.summary-item:hover{transform:translateY(-5px);box-shadow:0 8px 16px rgba(0,0,0,0.2);}
.summary-item h2{font-size:1em;color:var(--secondary-text);margin:0 0 10px 0;font-weight:400;}
.summary-item p{font-size:1.75em;font-weight:700;margin:0;}
.hedef-deger{color:var(--gold);}
.performance-metric{font-size:1.5em !important;color:var(--primary-text);}
.performance-metric span{font-size:.7em;color:var(--secondary-text);margin-left:8px;}
.main-content{display:flex;gap:30px;margin-top:20px;}
.portfolio-section{flex:3;}
.market-data-panel{flex:1;background-color:var(--bg-color);padding:20px;border-radius:8px;border:1px solid var(--border-color); transition: background-color 0.3s, border-color 0.3s;}
.chart-container .chart-fallback{margin-top:15px;color:var(--secondary-text);font-style:italic;}
main h2,.market-data-panel h2{color:var(--primary-text);border-bottom:1px solid var(--border-color);padding-bottom:10px;margin-top:0;}
table{width:100%;border-collapse:collapse;font-size:1em;table-layout:fixed;}
th,td{padding:12px 16px;border-bottom:1px solid var(--border-color);text-align:left;vertical-align:middle;word-wrap:break-word;}
th:nth-child(2),td:nth-child(2){width:10%;}
tbody tr{transition:background-color .2s ease;}
tbody tr:nth-child(even){background-color:rgba(0,0,0,0.2);}
body.light-theme tbody tr:nth-child(even){background-color: #F7F8FA;}
tbody tr:hover,tbody tr.highlight{background-color:var(--highlight-color);}
.positive{color:var(--green);font-weight:500;}
.negative{color:var(--red);font-weight:500;}
.bottom-content{display:flex;gap:30px;margin-top:30px;border-top:1px solid var(--border-color);padding-top:20px;}
.analysis-panel{flex:1;}
.news-panel{flex:2;padding-right:20px;margin-top:40px;}
#news-list { list-style: none; padding: 0; position: relative; height: 320px; overflow: hidden; }
#news-list li { background-color: var(--bg-color); padding: 10px; border-radius: 5px; margin-bottom: 15px; transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out; }
#news-list li.fade-out { opacity: 0; transform: translateY(-20px); }
#news-list h3 { margin: 0 0 5px 0; color: var(--primary-text); font-size: 1em; }
.analysis-container{display:flex;gap:20px;}
.analysis-side{flex:1;background-color:var(--bg-color);padding:15px;border-radius:8px;}
.analysis-side h3{margin-top:0;text-align:center;color:var(--secondary-text);}
.analysis-side ul{list-style:none;padding:0;margin:0;}
.analysis-side li{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:.9em; padding: 4px; border-radius: 3px;}
.flash-green{animation:flash-green .8s ease-out;}
.flash-red{animation:flash-red .8s ease-out;}
@keyframes flash-green{0%{background-color:rgba(38,166,154,0.5);} 100%{background-color:transparent;}}
@keyframes flash-red{0%{background-color:rgba(239,83,80,0.5);} 100%{background-color:transparent;}}
.quote-container{text-align:center;margin-top:40px;padding:20px;border-top:1px solid var(--border-color);}
footer{text-align:center;margin-top:10px;color:var(--secondary-text);font-size:.9em;}
.signature{color:#444;font-family:'Georgia',serif;font-style:italic;font-size:1.1em;margin-bottom:15px;transition:color .3s ease;}
body.light-theme .signature{color:#ccc;}
.signature:hover{color:#666;}
body.light-theme .signature:hover{color:#aaa;}
.icon-button{background:0 0;border:1px solid var(--border-color);color:var(--secondary-text);font-size:1.35em;width:45px;height:45px;border-radius:50%;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;justify-content:center;}
.icon-button:hover{background-color:var(--border-color);color:var(--primary-text);}
.icon-button:disabled,.icon-button[aria-disabled="true"]{cursor:not-allowed;opacity:0.6;transform:none;}
.icon-button.is-loading::after{content:"";width:18px;height:18px;border:2px solid var(--secondary-text);border-top-color:var(--primary-text);border-radius:50%;animation:spin 1s linear infinite;}
.icon-button.is-loading{color:transparent;}
.header-actions #settings-btn:hover{transform:rotate(45deg);}
.icon-button:focus-visible,.close-btn:focus-visible,#theme-toggle:focus-visible{outline:2px solid var(--blue);outline-offset:2px;}
.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1000;}
.modal-overlay[hidden]{display:none;}
.modal-content{background-color:var(--surface-color);padding:30px 40px;border-radius:12px;border:1px solid var(--border-color);width:90%;max-width:500px;position:relative;}
.close-btn{position:absolute;top:10px;right:15px;background:0 0;border:none;font-size:2em;color:var(--secondary-text);cursor:pointer;}
#theme-toggle{padding:10px 20px;border:none;border-radius:4px;background-color:var(--blue);color:#fff;font-weight:700;cursor:pointer;}
.analysis-side ul[aria-live="polite"]{min-height:160px;}
.visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
@keyframes refresh-pulse{0%{box-shadow:0 0 0 0 rgba(3,169,244,0.55);}100%{box-shadow:0 0 0 20px rgba(3,169,244,0);}}
@keyframes spin{to{transform:rotate(360deg);}}
@media (prefers-reduced-motion: reduce){
    .ticker-move{animation:none;}
    #news-list li{transition:none;}
    .icon-button.is-loading::after{animation:none;}
    .summary.is-updated .summary-item{animation:none;}
}
@media(max-width:992px){.main-content,.bottom-content{flex-direction:column;}}
@media(max-width:576px){body{padding:10px;} .container{padding:15px;}.summary-item p{font-size:1.5em;}}

</style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="dark-theme">
    <div id="particles-js"></div>
    <div class="container">
        <div class="ticker-wrap">
            <div class="ticker-move" id="ticker-move" role="marquee" aria-live="polite" aria-label="Güncel piyasa verileri"></div>
        </div>
        <header>
            <div class="header-top">
                <div class="profile"><img src="profil.jpg" alt="Ali Karapıçak profil fotoğrafı" onerror="this.onerror=null;this.src='https://via.placeholder.com/60x60.png?text=AK';"><h1 class="profile-name">Borsa Portföyü</h1></div>
                <div class="header-actions">
                    <button id="refresh-btn" class="icon-button" aria-label="Verileri yenile" title="Verileri yenile">⟳</button>
                    <button id="settings-btn" class="icon-button" aria-label="Ayarlar" aria-haspopup="dialog" aria-expanded="false" aria-controls="settings-modal">⚙️</button>
                </div>
            </div>
            <div class="summary">
                <div class="summary-item"><h2>Toplam Değer</h2><p id="toplam-deger">Hesaplanıyor...</p></div>
                <div class="summary-item"><h2>Toplam Kâr/Zarar</h2><p id="toplam-kar-zarar">Hesaplanıyor...</p></div>
                <div class="summary-item"><h2>1 Yıllık Hedef (%40 Artış)</h2><p id="bir-yillik-hedef" class="hedef-deger">Hesaplanıyor...</p></div>
                <div class="summary-item"><h2>Geleceğin Yıldızı (1Y Fiyat Hedefi)</h2><p id="best-performer" class="performance-metric">Hesaplanıyor...</p></div>
                <div class="summary-item"><h2>Gizli Hazine (Dengeleme Hedefi)</h2><p id="smallest-position" class="performance-metric">Hesaplanıyor...</p></div>
            </div>
            <p id="data-status" class="visually-hidden" role="status" aria-live="polite"></p>
        </header>
        <div class="main-content">
            <main class="portfolio-section">
                <h2>Varlıklarım</h2>
                <table id="hisse-tablosu">
                    <thead>
                        <tr>
                            <th>Hisse</th><th>Ağırlık</th><th>Lot</th><th>Maliyet</th><th>Anlık Fiyat</th><th>Toplam Değer</th><th>Kâr/Zarar</th><th>K/Z (%)</th>
                        </tr>
                    </thead>
                    <tbody id="hisse-listesi"></tbody>
                </table>
                 <section class="news-panel">
                    <h2>Piyasa Haberleri</h2>
                    <ul id="news-list" aria-live="polite" aria-atomic="false"></ul>
                </section>
            </main>
            <aside class="market-data-panel">
                <div class="chart-container"><h2>Portföy Dağılımı</h2><canvas id="portfolioChart"></canvas></div>
                <h2>Piyasa Verileri</h2>
                <div class="market-category"><h3>En Çok Yükselenler</h3><ul id="top-gainers-list"></ul></div>
                <div class="market-category"><h3>En Çok Düşenler</h3><ul id="top-losers-list"></ul></div>
                <div class="market-category"><h3>Hacmi En Yüksekler</h3><ul id="top-volume-list"></ul></div>
            </aside>
        </div>
        <div class="bottom-content">
            <section class="analysis-panel">
                <h2>Anlık Takas Analizi (Canlı Veri)</h2>
                <div class="analysis-container">
                    <div class="analysis-side"><h3>Alıcı Kurumlar</h3><ul id="buyers-list" aria-live="polite" aria-atomic="true"></ul></div>
                    <div class="analysis-side"><h3>Satıcı Kurumlar</h3><ul id="sellers-list" aria-live="polite" aria-atomic="true"></ul></div>
                </div>
            </section>
        </div>
        <div class="quote-container"><p id="quote-text" aria-live="polite" aria-atomic="true"></p><p id="quote-author"></p></div>
        <div class="ticker-wrap secondary-ticker">
            <div class="ticker-move" id="secondary-ticker-move" role="marquee" aria-live="polite" aria-label="Döviz ve değerli maden fiyatları"></div>
        </div>
        <footer>
            <div class="signature">Broker Ali Karapıçak</div>
            <p>Son Güncelleme: <span id="son-guncelleme"></span></p>
        </footer>
    </div>
    <div id="settings-modal" class="modal-overlay" role="presentation" hidden aria-hidden="true">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="settings-title" tabindex="-1">
            <button id="close-modal-btn" class="close-btn" aria-label="Kapat" data-modal-close>&times;</button>
            <h2 id="settings-title">Ayarlar</h2>
            <div class="setting-item">
                <label for="theme-toggle">Site Teması</label>
                <button id="theme-toggle" data-modal-initial-focus>Açık/Koyu Tema Değiştir</button>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
// Kodun tamamını, daha temiz ve global değişkenlerden arındırılmış bir yapıya soktum.
(function() {
    const defaultData = {
        portfolio: [
            { sembol: "SMARTG", lot: 8501, maliyet: 40.75, anlikFiyat: 30.80 },
            { sembol: "ARDYZ",  lot: 3568, maliyet: 36.04, anlikFiyat: 28.10 },
            { sembol: "KCAER",  lot: 5601, maliyet: 14.77, anlikFiyat: 14.63 },
            { sembol: "SASA",   lot: 11290, maliyet: 3.32,  anlikFiyat: 4.20  }
        ],
        quotes: [
            { soz: "Borsa, sabırsız olanın sabırlı olana para aktardığı bir mekanizmadır.", yazar: "Warren Buffett" },
            { soz: "Ne zaman satacağını bilmeyen, ne zaman alacağını da bilemez.", yazar: "André Kostolany" }
        ],
        marketData: {
            yukselenler: [ { sembol: "TUPRS", degisim: "+5.67%" }, { sembol: "THYAO", degisim: "+4.12%" } ],
            dusenler: [ { sembol: "KRDMD", degisim: "-2.50%" }, { sembol: "HEKTS", degisim: "-2.88%" } ],
            hacimliler: [ { sembol: "GARAN", hacim: "2.1 Milyar ₺" } ]
        },
        news: [
            { baslik: "Yenilenebilir Enerji Raporu: Güneş Panelleri Yatırımları Zirvede", ozet: "Uluslararası Enerji Ajansı'nın yayımladığı son rapora göre, artan enerji talebi ve teşvikler sayesinde güneş enerjisi santrallerine (GES) yapılan yatırımların rekor seviyeye ulaştığı belirtildi.", tarih: "22 Eylül 2025" },
            { baslik: "BIST 100 Günü Yükselişle Tamamladı", ozet: "Borsa İstanbul'da BIST 100 endeksi, günü %1,25 değer kazancıyla 9.150 puandan tamamladı...", tarih: "22 Eylül 2025" },
            { baslik: "Teknoloji Sektörü İçin Yeni Teşvik Paketi Yolda", ozet: "Sanayi ve Teknoloji Bakanlığı'nın, yerli yazılım üreticilerini destekleyecek yeni bir teşvik paketi üzerinde çalıştığı bildirildi...", tarih: "21 Eylül 2025" }
        ],
        brokers: ["İŞ YATIRIM", "BANK OF AMERICA", "GARANTİ BBVA", "YAPI KREDİ", "AK YATIRIM", "ÜNLÜ & CO", "TEB YATIRIM", "HALK YATIRIM", "ODEA BANK", "PHILLIPCAPITAL"],
        financialData: [
            { sembol: "GRAM ALTIN", fiyat: "2.450,78 ₺", degisim: "+0.25%", sinif: "positive" },
            { sembol: "ONS ALTIN", fiyat: "2.330,45 $", degisim: "-0.15%", sinif: "negative" },
            { sembol: "USD/TRY", fiyat: "32,85 ₺", degisim: "+0.05%", sinif: "positive" }
        ]
    };

    let portfoy = [...defaultData.portfolio];
    let ozluSozler = [...defaultData.quotes];
    let sahtePiyasaVerileri = JSON.parse(JSON.stringify(defaultData.marketData));
    let sahteHaberler = [...defaultData.news];
    let araciKurumlar = [...defaultData.brokers];
    let sahteFinansVerileri = [...defaultData.financialData];

    let portfolioChart = null;
    let newsInterval = null;
    let analysisInterval = null;
    let currentNewsIndex = 0;
    let modalIsOpen = false;
    let modalTriggerButton = null;
    let shouldRotateNews = false;
    let isLoadingData = false;
    let dataStatusElement = null;
    let refreshButton = null;
    let refreshButtonDefaultLabel = 'Verileri yenile';

    if (typeof Chart === 'undefined') {
        console.error('Chart.js bulunamadı. Grafik bileşeni devre dışı bırakılacak.');
    } else if (typeof ChartDataLabels !== 'undefined') {
        Chart.register(ChartDataLabels);
    } else {
        console.warn('chartjs-plugin-datalabels yüklenemedi; grafik etiketleri devre dışı.');
    }

    document.addEventListener("DOMContentLoaded", function() {
        dataStatusElement = document.getElementById('data-status');
        setupEventListeners();
        initializeApp();
        startParticles();
    });

    async function initializeApp() {
        setLoadingState(true, 'Veriler yükleniyor...');
        const { dataset, fallbackUsed } = await fetchInitialData();
        applyDataset(dataset);
        const timestamp = new Date();
        runInitialFunctions(timestamp);
        const message = fallbackUsed ?
            `Veriler yerel örneklerle güncellendi (${timestamp.toLocaleTimeString('tr-TR')}).` :
            `Veriler güncellendi (${timestamp.toLocaleTimeString('tr-TR')}).`;
        setLoadingState(false, message);
        if (!document.hidden) {
            startIntervals();
        }
    }

    async function fetchInitialData() {
        let fallbackUsed = false;
        try {
            const response = await fetch('data/mock-data.json', { cache: 'no-store' });
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            const json = await response.json();
            const dataset = {};

            if (Array.isArray(json.portfolio) && json.portfolio.length) {
                dataset.portfolio = json.portfolio;
            } else {
                dataset.portfolio = [...defaultData.portfolio];
                fallbackUsed = true;
            }

            if (Array.isArray(json.quotes) && json.quotes.length) {
                dataset.quotes = json.quotes;
            } else {
                dataset.quotes = [...defaultData.quotes];
                fallbackUsed = true;
            }

            if (validateMarketData(json.marketData)) {
                dataset.marketData = json.marketData;
            } else {
                dataset.marketData = JSON.parse(JSON.stringify(defaultData.marketData));
                fallbackUsed = true;
            }

            if (Array.isArray(json.news) && json.news.length) {
                dataset.news = json.news;
            } else {
                dataset.news = [...defaultData.news];
                fallbackUsed = true;
            }

            if (Array.isArray(json.brokers) && json.brokers.length) {
                dataset.brokers = json.brokers;
            } else {
                dataset.brokers = [...defaultData.brokers];
                fallbackUsed = true;
            }

            if (Array.isArray(json.financialData) && json.financialData.length) {
                dataset.financialData = json.financialData;
            } else {
                dataset.financialData = [...defaultData.financialData];
                fallbackUsed = true;
            }

            return { dataset, fallbackUsed };
        } catch (error) {
            console.warn('Veriler yüklenirken bir sorun oluştu, varsayılan veriler kullanılacak.', error);
            return {
                dataset: {
                    portfolio: [...defaultData.portfolio],
                    quotes: [...defaultData.quotes],
                    marketData: JSON.parse(JSON.stringify(defaultData.marketData)),
                    news: [...defaultData.news],
                    brokers: [...defaultData.brokers],
                    financialData: [...defaultData.financialData]
                },
                fallbackUsed: true
            };
        }
    }

    function validateMarketData(data) {
        if (!data || typeof data !== 'object') return false;
        const keys = ['yukselenler', 'dusenler', 'hacimliler'];
        return keys.every(key => Array.isArray(data[key]));
    }

    function applyDataset(dataset) {
        portfoy = Array.isArray(dataset.portfolio) ? dataset.portfolio.map(item => ({ ...item })) : [...defaultData.portfolio];
        ozluSozler = Array.isArray(dataset.quotes) ? dataset.quotes.map(item => ({ ...item })) : [...defaultData.quotes];
        sahtePiyasaVerileri = validateMarketData(dataset.marketData) ? JSON.parse(JSON.stringify(dataset.marketData)) : JSON.parse(JSON.stringify(defaultData.marketData));
        sahteHaberler = Array.isArray(dataset.news) ? dataset.news.map(item => ({ ...item })) : [...defaultData.news];
        araciKurumlar = Array.isArray(dataset.brokers) ? [...dataset.brokers] : [...defaultData.brokers];
        sahteFinansVerileri = Array.isArray(dataset.financialData) ? dataset.financialData.map(item => ({ ...item })) : [...defaultData.financialData];
    }

    function setLoadingState(isLoading, message) {
        isLoadingData = isLoading;
        if (refreshButton) {
            refreshButton.disabled = isLoading;
            refreshButton.setAttribute('aria-disabled', isLoading ? 'true' : 'false');
            refreshButton.classList.toggle('is-loading', isLoading);
            refreshButton.setAttribute('aria-label', isLoading ? 'Veriler yenileniyor...' : refreshButtonDefaultLabel);
            refreshButton.setAttribute('title', isLoading ? 'Veriler yenileniyor...' : refreshButtonDefaultLabel);
        }

        const summary = document.querySelector('.summary');
        if (summary) {
            summary.setAttribute('aria-busy', isLoading ? 'true' : 'false');
            if (!isLoading) {
                highlightSummary(summary);
            } else {
                summary.classList.remove('is-updated');
            }
        }

        ['news-list', 'buyers-list', 'sellers-list'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.setAttribute('aria-busy', isLoading ? 'true' : 'false');
            }
        });

        if (typeof message === 'string') {
            updateDataStatus(message);
        }

        ensureNewsInterval();
    }

    function updateDataStatus(message) {
        if (!dataStatusElement) return;
        dataStatusElement.textContent = message || '';
    }

    function highlightSummary(element) {
        if (!element) return;
        element.classList.add('is-updated');
        setTimeout(() => element.classList.remove('is-updated'), 600);
    }

    async function handleManualRefresh() {
        if (isLoadingData) return;
        stopIntervals();
        setLoadingState(true, 'Veriler yenileniyor...');
        const { dataset, fallbackUsed } = await fetchInitialData();
        applyDataset(dataset);
        const timestamp = new Date();
        runInitialFunctions(timestamp);
        const statusMessage = fallbackUsed ?
            `Veriler uzaktan alınamadı, yerel örnekler gösteriliyor (${timestamp.toLocaleTimeString('tr-TR')}).` :
            `Veriler başarıyla yenilendi (${timestamp.toLocaleTimeString('tr-TR')}).`;
        setLoadingState(false, statusMessage);
        if (!document.hidden) {
            startIntervals();
        }
    }

    function setupEventListeners() {
        const settingsBtn = document.getElementById('settings-btn');
        const modal = document.getElementById('settings-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const themeToggleBtn = document.getElementById('theme-toggle');
        refreshButton = document.getElementById('refresh-btn');

        const savedTheme = localStorage.getItem('theme');
        const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
        const initialTheme = (savedTheme === 'light' || savedTheme === 'dark') ? savedTheme : (prefersLight ? 'light' : 'dark');
        document.body.classList.remove('dark-theme', 'light-theme');
        document.body.classList.add(`${initialTheme}-theme`);

        settingsBtn.addEventListener('click', () => openModal(modal, settingsBtn));
        closeModalBtn.addEventListener('click', () => closeModal(modal));
        modal.addEventListener('click', (event) => { if (event.target === modal) { closeModal(modal); } });

        if (refreshButton) {
            refreshButtonDefaultLabel = refreshButton.getAttribute('aria-label') || refreshButtonDefaultLabel;
            refreshButton.addEventListener('click', handleManualRefresh);
        }

        themeToggleBtn.addEventListener('click', () => {
            const newTheme = document.body.classList.contains('dark-theme') ? 'light' : 'dark';
            document.body.classList.remove('dark-theme', 'light-theme');
            document.body.classList.add(newTheme + '-theme');
            localStorage.setItem('theme', newTheme);
            updateChartTheme();
        });

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopIntervals();
            } else if (!isLoadingData) {
                startIntervals();
            }
        });
    }

    function openModal(modal, triggerButton) {
        modalTriggerButton = triggerButton;
        modal.hidden = false;
        modal.setAttribute('aria-hidden', 'false');
        document.body.classList.add('modal-open');
        triggerButton.setAttribute('aria-expanded', 'true');
        modalIsOpen = true;
        const focusTarget = modal.querySelector('[data-modal-initial-focus]') || modal.querySelector('.modal-content');
        (focusTarget || modal).focus();
        document.addEventListener('keydown', trapFocusWithinModal);
    }

    function closeModal(modal) {
        modal.hidden = true;
        modal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('modal-open');
        if (modalTriggerButton) {
            modalTriggerButton.setAttribute('aria-expanded', 'false');
            modalTriggerButton.focus();
        }
        modalTriggerButton = null;
        modalIsOpen = false;
        document.removeEventListener('keydown', trapFocusWithinModal);
    }

    function trapFocusWithinModal(event) {
        if (!modalIsOpen) return;
        const modal = document.getElementById('settings-modal');
        if (event.key === 'Escape') {
            closeModal(modal);
            return;
        }
        if (event.key !== 'Tab') return;

        const focusableSelectors = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
        const focusableElements = Array.from(modal.querySelectorAll(focusableSelectors))
            .filter(el => !el.hasAttribute('disabled') && el.offsetParent !== null);
        if (!focusableElements.length) return;

        const firstElement = focusableElements[0];
        const lastElement = focusableElements[focusableElements.length - 1];

        if (event.shiftKey && document.activeElement === firstElement) {
            event.preventDefault();
            lastElement.focus();
        } else if (!event.shiftKey && document.activeElement === lastElement) {
            event.preventDefault();
            firstElement.focus();
        }
    }

    function runInitialFunctions(timestamp = new Date()) {
        portfoyuGuncelle(timestamp);
        ozluSozGoster();
        sahtePiyasaVerileriniDoldur();
        populateTicker();
        populateNews();
        populateSecondaryTicker();
        updateAnalysis();
    }

    function startIntervals() {
        if (!analysisInterval) {
            analysisInterval = setInterval(updateAnalysis, 3000);
        }
        ensureNewsInterval();
    }

    function stopIntervals() {
        if (analysisInterval) {
            clearInterval(analysisInterval);
            analysisInterval = null;
        }
        if (newsInterval) {
            clearInterval(newsInterval);
            newsInterval = null;
        }
    }

    function ensureNewsInterval() {
        if (isLoadingData) {
            if (newsInterval) {
                clearInterval(newsInterval);
                newsInterval = null;
            }
            return;
        }

        if (shouldRotateNews && !newsInterval && !document.hidden) {
            newsInterval = setInterval(rotateNews, 10000);
        } else if ((!shouldRotateNews || document.hidden) && newsInterval) {
            clearInterval(newsInterval);
            newsInterval = null;
        }
    }

    function portfoyuGuncelle(timestamp = new Date()) {
        const hisseListesiBody = document.getElementById('hisse-listesi');
        const toplamDegerElem = document.getElementById('toplam-deger');
        const toplamKarZararElem = document.getElementById('toplam-kar-zarar');
        const birYillikHedefElem = document.getElementById('bir-yillik-hedef');
        const bestPerformerElem = document.getElementById('best-performer');
        const smallestPositionElem = document.getElementById('smallest-position');
        hisseListesiBody.innerHTML = '';
        let toplamPortfoyDegeri = 0;
        const chartLabels = [], chartData = [], performanceData = [];
        const formattedTimestamp = (timestamp instanceof Date && !Number.isNaN(timestamp.getTime())) ? timestamp.toLocaleTimeString('tr-TR') : new Date().toLocaleTimeString('tr-TR');

        if (!Array.isArray(portfoy) || portfoy.length === 0) {
            hisseListesiBody.innerHTML = '<tr><td colspan="8">Portföy verisi bulunamadı.</td></tr>';
            toplamDegerElem.textContent = 'Veri Yok';
            toplamKarZararElem.textContent = 'Veri Yok';
            toplamKarZararElem.classList.remove('positive', 'negative');
            birYillikHedefElem.textContent = 'Veri Yok';
            bestPerformerElem.textContent = 'Veri Yok';
            smallestPositionElem.textContent = 'Veri Yok';
            document.getElementById('son-guncelleme').textContent = formattedTimestamp;
            grafigiCiz([], [], 0);
            return;
        }

        portfoy.forEach(hisse => {
            const lot = Number(hisse.lot) || 0;
            const price = Number(hisse.anlikFiyat) || 0;
            toplamPortfoyDegeri += lot * price;
        });
        const fragment = document.createDocumentFragment();
        portfoy.forEach(hisse => {
            const lot = Number(hisse.lot) || 0;
            const maliyet = Number(hisse.maliyet) || 0;
            const anlikFiyat = Number(hisse.anlikFiyat) || 0;
            const toplamDeger = lot * anlikFiyat;
            const maliyetDegeri = lot * maliyet;
            const karZararYuzde = maliyet > 0 ? ((anlikFiyat - maliyet) / maliyet) * 100 : 0;
            const agirlik = toplamPortfoyDegeri > 0 ? (toplamDeger / toplamPortfoyDegeri) * 100 : 0;
            chartLabels.push(hisse.sembol || '—');
            chartData.push(toplamDeger);
            performanceData.push({ sembol: hisse.sembol || '—', yuzde: karZararYuzde, deger: toplamDeger, anlikFiyat: anlikFiyat });
            const newRow = document.createElement('tr');
            const agirlikText = Number.isFinite(agirlik) ? agirlik.toFixed(2) : '0.00';
            newRow.innerHTML = `<td>${hisse.sembol || '—'}</td><td><b>${agirlikText}%</b></td><td>${lot.toLocaleString('tr-TR')}</td><td>${formatCurrency(maliyet)}</td><td>${formatCurrency(anlikFiyat)}</td><td>${formatCurrency(toplamDeger)}</td><td class="${(toplamDeger - maliyetDegeri) >= 0 ? 'positive' : 'negative'}">${formatCurrency(toplamDeger - maliyetDegeri)}</td><td class="${karZararYuzde >= 0 ? 'positive' : 'negative'}">${karZararYuzde.toFixed(2)}%</td>`;
            fragment.appendChild(newRow);
        });
        hisseListesiBody.appendChild(fragment);
        const toplamMaliyet = portfoy.reduce((sum, hisse) => {
            const lot = Number(hisse.lot) || 0;
            const maliyet = Number(hisse.maliyet) || 0;
            return sum + (lot * maliyet);
        }, 0);
        const toplamKarZarar = toplamPortfoyDegeri - toplamMaliyet;
        toplamDegerElem.textContent = formatCurrency(toplamPortfoyDegeri);
        const toplamKarZararYuzde = toplamMaliyet > 0 ? (toplamKarZarar / toplamMaliyet) * 100 : 0;
        const toplamKarZararYuzdeText = Number.isFinite(toplamKarZararYuzde) ? toplamKarZararYuzde.toFixed(2) : '0.00';
        toplamKarZararElem.textContent = `${formatCurrency(toplamKarZarar)} (${toplamKarZararYuzdeText}%)`;
        setElementColor(toplamKarZararElem, toplamKarZarar);
        birYillikHedefElem.textContent = formatCurrency(toplamPortfoyDegeri * 1.40);
        if (performanceData.length > 0) {
            const best = performanceData.reduce((p, c) => (p.yuzde > c.yuzde) ? p : c);
            bestPerformerElem.innerHTML = `${best.sembol} <span class="hedef-deger">${formatCurrency(best.anlikFiyat * 1.60)}</span>`;
            const smallest = performanceData.reduce((p, c) => (p.deger < c.deger) ? p : c);
            smallestPositionElem.innerHTML = `${smallest.sembol} <span class="hedef-deger">${formatCurrency(toplamPortfoyDegeri * 0.20)}</span>`;
        }
        document.getElementById('son-guncelleme').textContent = formattedTimestamp;
        grafigiCiz(chartLabels, chartData, toplamPortfoyDegeri);
        interaktifVurgulamaEkle();
    }

    function updateChartTheme() {
        if (!portfolioChart) return;
        const isLightTheme = document.body.classList.contains('light-theme');
        const legendColor = isLightTheme ? '#1C1E21' : '#E0E0E0';
        const datalabelsColor = isLightTheme ? '#333' : '#fff';
        if (portfolioChart.options && portfolioChart.options.plugins && portfolioChart.options.plugins.legend) {
            portfolioChart.options.plugins.legend.labels.color = legendColor;
        }
        if (portfolioChart.options && portfolioChart.options.plugins && portfolioChart.options.plugins.datalabels) {
            portfolioChart.options.plugins.datalabels.color = datalabelsColor;
        }
        portfolioChart.update();
    }

    function grafigiCiz(labels, data, toplamDeger) {
        const canvas = document.getElementById('portfolioChart');
        if (!canvas) return;
        const container = canvas.parentElement;

        if (typeof Chart === 'undefined') {
            canvas.style.display = 'none';
            if (container && !container.querySelector('.chart-fallback')) {
                const fallback = document.createElement('p');
                fallback.className = 'chart-fallback';
                fallback.textContent = 'Grafik bileşeni yüklenemedi. Veri özetleri tabloda sunulmaya devam ediyor.';
                container.appendChild(fallback);
            }
            return;
        }

        canvas.style.display = '';
        if (container) {
            const fallback = container.querySelector('.chart-fallback');
            if (fallback) fallback.remove();
        }

        const ctx = canvas.getContext('2d');
        if (portfolioChart) portfolioChart.destroy();
        const isLightTheme = document.body.classList.contains('light-theme');
        const legendColor = isLightTheme ? '#1C1E21' : '#E0E0E0';
        const datalabelsColor = isLightTheme ? '#333' : '#fff';
        const hasPositiveValue = Array.isArray(data) && data.some(value => value > 0);
        const displayLabels = hasPositiveValue ? labels : ['Veri Yok'];
        const displayData = hasPositiveValue ? data : [1];
        const pluginsConfig = {
            legend: { position: 'top', labels: { color: legendColor } }
        };

        if (typeof ChartDataLabels !== 'undefined') {
            pluginsConfig.datalabels = {
                display: hasPositiveValue && toplamDeger > 0,
                formatter: (value) => toplamDeger > 0 ? ((value / toplamDeger) * 100).toFixed(1) + '%' : '',
                color: datalabelsColor,
                font: { weight: 'bold', size: 14 }
            };
        }

        portfolioChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: displayLabels,
                datasets: [{
                    label: 'Portföy Değeri',
                    data: displayData,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                onHover: handleChartHover,
                plugins: pluginsConfig
            }
        });
    }

    function handleChartHover(event, elements) {
        document.querySelectorAll('#hisse-listesi tr').forEach(row => row.classList.remove('highlight'));
        if (elements.length > 0) {
            const index = elements[0].index;
            const row = document.querySelector(`#hisse-listesi tr:nth-child(${index + 1})`);
            if (row) row.classList.add('highlight');
        }
    }

    function interaktifVurgulamaEkle() {
        if (!portfolioChart) return;
        const rows = document.querySelectorAll('#hisse-listesi tr');
        rows.forEach((row, index) => {
            row.addEventListener('mouseover', () => {
                portfolioChart.setActiveElements([{ datasetIndex: 0, index: index }]);
                portfolioChart.update();
            });
            row.addEventListener('mouseout', () => {
                portfolioChart.setActiveElements([]);
                portfolioChart.update();
            });
        });
    }

    function createTickerFallback(text) {
        const item = document.createElement('div');
        item.className = 'ticker-item';
        item.textContent = text;
        return item;
    }

    function renderTickerItems(container, nodes, fallbackText = 'Veri bulunamadı.') {
        if (!container) return;
        container.innerHTML = '';
        const fragment = document.createDocumentFragment();
        if (!nodes.length) {
            fragment.appendChild(createTickerFallback(fallbackText));
        } else {
            nodes.forEach(node => fragment.appendChild(node));
            nodes.forEach(node => fragment.appendChild(node.cloneNode(true)));
        }
        container.appendChild(fragment);
    }

    function createMarketTickerNode(item) {
        const container = document.createElement('div');
        container.className = 'ticker-item';
        const symbolSpan = document.createElement('span');
        symbolSpan.className = 'symbol';
        symbolSpan.textContent = (item && item.sembol) ? item.sembol : 'Bilinmiyor';
        container.appendChild(symbolSpan);

        const changeText = (item && typeof item.degisim === 'string') ? item.degisim.trim() : '';
        if (changeText) {
            container.appendChild(document.createTextNode(' '));
            const changeSpan = document.createElement('span');
            const isPositive = changeText.startsWith('+');
            changeSpan.classList.add(isPositive ? 'positive' : 'negative');
            changeSpan.textContent = `${isPositive ? '▲' : '▼'} ${changeText}`;
            container.appendChild(changeSpan);
        } else if (item && item.hacim) {
            container.appendChild(document.createTextNode(' '));
            const volumeSpan = document.createElement('span');
            volumeSpan.textContent = `Hacim: ${item.hacim}`;
            container.appendChild(volumeSpan);
        }

        return container;
    }

    function createFinancialTickerNode(item) {
        const container = document.createElement('div');
        container.className = 'ticker-item';
        const symbolSpan = document.createElement('span');
        symbolSpan.className = 'symbol';
        symbolSpan.textContent = (item && item.sembol) ? item.sembol : '—';
        container.appendChild(symbolSpan);

        if (item && item.fiyat) {
            container.appendChild(document.createTextNode(' '));
            const priceSpan = document.createElement('span');
            priceSpan.textContent = item.fiyat;
            container.appendChild(priceSpan);
        }

        if (item && item.degisim) {
            container.appendChild(document.createTextNode(' '));
            const changeSpan = document.createElement('span');
            if (item.sinif) {
                changeSpan.classList.add(item.sinif);
            }
            changeSpan.textContent = item.degisim;
            container.appendChild(changeSpan);
        }

        return container;
    }

    function populateTicker() {
        const tickerMove = document.getElementById('ticker-move');
        if (!tickerMove) return;
        if (!sahtePiyasaVerileri || typeof sahtePiyasaVerileri !== 'object') {
            renderTickerItems(tickerMove, [], 'Piyasa verisi yüklenemedi.');
            return;
        }
        const allMarketData = [
            ...(Array.isArray(sahtePiyasaVerileri.yukselenler) ? sahtePiyasaVerileri.yukselenler : []),
            ...(Array.isArray(sahtePiyasaVerileri.dusenler) ? sahtePiyasaVerileri.dusenler : []),
            ...(Array.isArray(sahtePiyasaVerileri.hacimliler) ? sahtePiyasaVerileri.hacimliler : [])
        ];
        if (!allMarketData.length) {
            renderTickerItems(tickerMove, [], 'Piyasa verisi bulunamadı.');
            return;
        }
        const nodes = allMarketData.map(createMarketTickerNode);
        renderTickerItems(tickerMove, nodes, 'Piyasa verisi bulunamadı.');
    }

    function populateSecondaryTicker() {
        const tickerMove = document.getElementById('secondary-ticker-move');
        if (!tickerMove) return;
        if (!Array.isArray(sahteFinansVerileri) || !sahteFinansVerileri.length) {
            renderTickerItems(tickerMove, [], 'Finans verisi bulunamadı.');
            return;
        }
        const nodes = sahteFinansVerileri.map(createFinancialTickerNode);
        renderTickerItems(tickerMove, nodes, 'Finans verisi bulunamadı.');
    }

    function createNewsItemNode(haber) {
        const li = document.createElement('li');
        const title = document.createElement('h3');
        title.textContent = haber && haber.baslik ? haber.baslik : 'Başlık bulunamadı';
        li.appendChild(title);

        const summary = document.createElement('p');
        summary.textContent = haber && haber.ozet ? haber.ozet : 'Detay bilgisi bulunamadı.';
        li.appendChild(summary);

        const dateSpan = document.createElement('span');
        dateSpan.className = 'news-date';
        dateSpan.textContent = haber && haber.tarih ? haber.tarih : '';
        li.appendChild(dateSpan);

        return li;
    }

    function createNewsPlaceholder(text) {
        const li = document.createElement('li');
        li.textContent = text;
        return li;
    }

    function ozluSozGoster() {
        if (!Array.isArray(ozluSozler) || !ozluSozler.length) return;
        const rastgeleSoz = ozluSozler[Math.floor(Math.random() * ozluSozler.length)];
        document.getElementById('quote-text').textContent = `"${rastgeleSoz.soz}"`;
        document.getElementById('quote-author').textContent = `- ${rastgeleSoz.yazar}`;
    }

    function sahtePiyasaVerileriniDoldur() {
        const lists = { yukselenler: 'top-gainers-list', dusenler: 'top-losers-list', hacimliler: 'top-volume-list' };
        Object.keys(lists).forEach(key => {
            const listElement = document.getElementById(lists[key]);
            listElement.innerHTML = '';
            if (!sahtePiyasaVerileri || !Array.isArray(sahtePiyasaVerileri[key]) || !sahtePiyasaVerileri[key].length) {
                listElement.innerHTML = '<li>Veri bulunamadı.</li>';
                return;
            }
            const fragment = document.createDocumentFragment();
            sahtePiyasaVerileri[key].forEach(hisse => {
                const li = document.createElement('li');
                const nameSpan = document.createElement('span');
                nameSpan.className = 'stock-name';
                nameSpan.textContent = (hisse && hisse.sembol) ? hisse.sembol : '—';
                li.appendChild(nameSpan);

                const degisimText = (hisse && typeof hisse.degisim === 'string') ? hisse.degisim.trim() : '';
                if (degisimText) {
                    li.appendChild(document.createTextNode(' '));
                    const changeSpan = document.createElement('span');
                    changeSpan.className = `stock-change ${degisimText.startsWith('+') ? 'positive' : 'negative'}`;
                    changeSpan.textContent = degisimText;
                    li.appendChild(changeSpan);
                }

                if (hisse && hisse.hacim) {
                    li.appendChild(document.createTextNode(' '));
                    const volumeSpan = document.createElement('span');
                    volumeSpan.className = 'stock-volume';
                    volumeSpan.textContent = hisse.hacim;
                    li.appendChild(volumeSpan);
                }

                fragment.appendChild(li);
            });
            listElement.appendChild(fragment);
        });
    }

    function populateNews() {
        const newsList = document.getElementById('news-list');
        newsList.innerHTML = '';
        const displayCount = 3;
        currentNewsIndex = 0;
        if (!Array.isArray(sahteHaberler) || !sahteHaberler.length) {
            newsList.appendChild(createNewsPlaceholder('Haber verisi bulunamadı.'));
            shouldRotateNews = false;
            ensureNewsInterval();
            return;
        }
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < displayCount && i < sahteHaberler.length; i++) {
            const haber = sahteHaberler[i];
            fragment.appendChild(createNewsItemNode(haber));
            currentNewsIndex = i;
        }
        newsList.appendChild(fragment);
        shouldRotateNews = sahteHaberler.length > displayCount;
        ensureNewsInterval();
    }

    function rotateNews() {
        const newsList = document.getElementById('news-list');
        if (!shouldRotateNews || !newsList || newsList.children.length === 0) return;
        const firstNewsItem = newsList.children[0];
        firstNewsItem.classList.add('fade-out');
        setTimeout(() => {
            firstNewsItem.remove();
            currentNewsIndex++;
            if (currentNewsIndex >= sahteHaberler.length) { currentNewsIndex = 0; }
            const nextNews = sahteHaberler[currentNewsIndex];
            const newNewsItem = createNewsItemNode(nextNews);
            newsList.appendChild(newNewsItem);
        }, 800);
    }

    function createAnalysisListItem(brokerName, type) {
        const li = document.createElement('li');
        const nameSpan = document.createElement('span');
        nameSpan.className = 'broker-name';
        nameSpan.textContent = brokerName || '—';
        const lotSpan = document.createElement('span');
        const lot = Math.floor(Math.random() * 450001) + 50000;
        lotSpan.className = `broker-lot ${type === 'negative' ? 'negative' : 'positive'}`;
        lotSpan.textContent = `${lot.toLocaleString('tr-TR')} Lot`;
        li.appendChild(nameSpan);
        li.appendChild(document.createTextNode(' '));
        li.appendChild(lotSpan);
        const flashClass = type === 'negative' ? 'flash-red' : 'flash-green';
        li.classList.add(flashClass);
        setTimeout(() => li.classList.remove(flashClass), 800);
        return li;
    }

    function updateAnalysis() {
        const buyersList = document.getElementById('buyers-list');
        const sellersList = document.getElementById('sellers-list');
        if (!buyersList || !sellersList) return;
        buyersList.innerHTML = '';
        sellersList.innerHTML = '';
        if (!Array.isArray(araciKurumlar) || !araciKurumlar.length) {
            buyersList.innerHTML = '<li>Veri bulunamadı.</li>';
            sellersList.innerHTML = '<li>Veri bulunamadı.</li>';
            return;
        }
        const shuffledBrokers = [...araciKurumlar].sort(() => Math.random() - 0.5);
        const limitedBrokers = shuffledBrokers.slice(0, Math.min(shuffledBrokers.length, 10));
        const splitIndex = Math.ceil(limitedBrokers.length / 2);
        let buyers = limitedBrokers.slice(0, splitIndex);
        let sellers = limitedBrokers.slice(splitIndex);

        if (!sellers.length && buyers.length > 1) {
            const transferCount = Math.max(1, Math.floor(buyers.length / 2));
            sellers = buyers.splice(-transferCount, transferCount);
        }

        if (!buyers.length) {
            buyersList.innerHTML = '<li>Alıcı verisi bulunamadı.</li>';
        } else {
            const buyersFragment = document.createDocumentFragment();
            buyers.slice(0, 5).forEach(broker => buyersFragment.appendChild(createAnalysisListItem(broker, 'positive')));
            buyersList.appendChild(buyersFragment);
        }

        if (!sellers.length) {
            sellersList.innerHTML = '<li>Dengelenme için yeterli veri yok.</li>';
        } else {
            const sellersFragment = document.createDocumentFragment();
            sellers.slice(0, 5).forEach(broker => sellersFragment.appendChild(createAnalysisListItem(broker, 'negative')));
            sellersList.appendChild(sellersFragment);
        }
    }

    function formatCurrency(value, currency = 'TRY') {
        const numericValue = Number(value);
        if (!Number.isFinite(numericValue)) {
            return '—';
        }
        return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: currency }).format(numericValue);
    }

    function setElementColor(element, value) {
        element.classList.remove('positive', 'negative');
        if (value > 0) {
            element.classList.add('positive');
        } else if (value < 0) {
            element.classList.add('negative');
        }
    }

    function startParticles() {
        particlesJS("particles-js", {
            "particles": { "number": { "value": 80, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#888888" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": true }, "size": { "value": 3, "random": true }, "line_linked": { "enable": true, "distance": 150, "color": "#888888", "opacity": 0.4, "width": 1 }, "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false } },
            "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": false }, "resize": true }, "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 1 } } } },
            "retina_detect": true
        });
    }
})(); // Kodun tamamını sarmalayan ve global scope'u kirletmeyen yapı

</script>
</body>
</html>
